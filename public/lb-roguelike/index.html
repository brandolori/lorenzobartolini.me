<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lb-roguelike</title>
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function s(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=s(l);fetch(l.href,c)}})();const U=t=>{const o=Math.floor(Math.random()*t.length);return t[o]},vt=(t,o,s,i,l)=>{document.addEventListener("keydown",r,!1),document.addEventListener("keyup",m,!1);const c=new Set,p=new Set,g={w:"move-up",W:"move-up",a:"move-left",A:"move-left",s:"move-down",S:"move-down",d:"move-right",D:"move-right",ArrowLeft:"shoot-left",ArrowUp:"shoot-up",ArrowDown:"shoot-down",ArrowRight:"shoot-right"};function r(h){h.key in g&&p.add(g[h.key])}function m(h){h.key in g&&p.delete(g[h.key])}let u=o,f;const x=(h,P)=>{setTimeout(()=>{c.add(h)},P*1e3)};l.forEach(h=>x(h.id,h.time));const S=h=>{f===void 0&&(f=h);const P=(h-f)/1e3;f=h,p.forEach(C=>c.add(C));const{timers:w,state:E}=s(u,c,P);c.clear(),u=E,w.forEach(C=>x(C.id,C.time));const L=i(u);Pt(t,L),requestAnimationFrame(S)};requestAnimationFrame(S)},Pt=(t,o)=>{const s=t.getContext("2d");s.clearRect(0,0,t.width,t.height),o.forEach(i=>{const{x:l,y:c,char:p,size:g,color:r}=i;s.fillStyle=r,s.font=`bold ${g}px courier new`;const u=s.measureText(p).width,f=g,x=l-u/2,S=c+f/2;s.fillText(p,x,S)})},n={sum:(t,o)=>({x:t.x+o.x,y:t.y+o.y}),mult:(t,o)=>({x:t.x*o,y:t.y*o}),sub:(t,o)=>({x:t.x-o.x,y:t.y-o.y}),normalize:t=>{const o=Math.sqrt(t.x*t.x+t.y*t.y);return o===0?{x:0,y:0}:{x:t.x/o,y:t.y/o}},distance:(t,o)=>{const s=o.x-t.x,i=o.y-t.y;return Math.sqrt(s*s+i*i)},squareCollision:(t,o,s)=>Math.abs(t.x-o.x)<=s/2&&Math.abs(t.y-o.y)<=s/2,right:{x:1,y:0},left:{x:-1,y:0},up:{x:0,y:-1},down:{x:0,y:1},zero:{x:0,y:0},fromAngle:t=>({x:Math.cos(t),y:Math.sin(t)}),toAngle:t=>Math.atan2(t.y,t.x),random:t=>n.mult(n.fromAngle(Math.random()*Math.PI*2),t)},N="#000000",At="#00000080",at="red",lt="pink",Rt="green",v=80,Ht=.25,X={x:324,y:36},It=10,D=120,a=24,k=648,M=360,it=5,Et=20,Lt=2,_=a*2.5,Bt=2,Ot=5,ct=1,Ft=5,z=(t,o,s,i,l,c)=>({pos:n.sum(t,n.mult(s,a/4)),speed:n.sum(n.mult(s,i),o),type:l,enemy:c,lifetime:0}),V=(t,o)=>{const s=n.toAngle(t);return n.fromAngle(s+Math.random()*o-o/2)},F=(t,o,s)=>z(n.sum(t,n.mult(n.fromAngle(Math.random()*Math.PI*2),a/4)),o,V(s,.2),D*(Math.random()*.25+3),"shotgun",!1),pt=t=>{switch(t){case"normal":return 1;case"small":return .5;case"big":return 2;case"shotgun":return .75;case"rocket":return 1}},ht=(t,o)=>({x:t.x+Math.cos(o)*_,y:t.y+Math.sin(o)*_}),yt=(t,o)=>({x:t.x+Math.cos(o+Math.PI)*_,y:t.y+Math.sin(o+Math.PI)*_}),Vt=t=>{switch(t){case"none":return .3;case"big-gun":return .2;case"shotgun":return .75;case"uzi":return .1;case"glock":return .3}},dt=t=>({x:k-t.x,y:M-t.y}),ft=t=>{const o=["bible","bible2","ghost","twins","passthrough","rubber","swamp","rocket","tombstone"];return{pos:t,type:U(["big-gun","shotgun","uzi","glock"]),trinket:U(o)}},Wt=t=>{switch(t){case"wall1":return"â–§";case"wall2":return"â—©";case"wall3":return"â–©";case"block":return"â–¥";case"door":return"â–£"}},j=t=>{switch(t){case"none":return"@";case"big-gun":return"Â£";case"shotgun":return"$";case"uzi":return"â‚¬";case"glock":return"Â¥"}},Tt=t=>{switch(t){case"big":return 1.5;case"normal":return 1;case"small":return .75;case"shotgun":return .75;case"rocket":return .5;default:return 1}},Nt=t=>{switch(t){case"slime":return"Ã§";case"fast-slime":return"Ã‡";case"turret":return"Â¡";case"imp":return"#";case"rhino":return"Â§";default:return"?"}},H=t=>{switch(t){case"twins":return"ðŸ‘¬";case"rubber":return"ðŸŽˆ";case"bible":return"ðŸ“•";case"bible2":return"ðŸ“˜";case"passthrough":return"ðŸªŸ";case"ghost":return"ðŸ‘»";case"swamp":return"ðŸ¸";case"bus":return"ðŸšŒ";case"rocket":return"ðŸš€";case"tombstone":return"ðŸª¦"}},Yt=t=>{const o={...t.playerState.pos,char:j(t.playerState.weapon),size:a,color:t.playerState.hurt?lt:N},s=t.bullets.map(d=>({char:d.type=="rocket"?"ðŸš€":d.enemy?"âœ¦":"â€¢",color:d.enemy?at:N,size:a*Tt(d.type)*(d.enemy?.5:1),x:d.pos.x,y:d.enemy?d.pos.y+a*.25:d.pos.y})),i=t.enemies.map(d=>({char:Nt(d.type),color:d.hurt?lt:at,size:a,...d.pos})),l=t.obstacles.map(d=>({char:Wt(d.type),color:N,size:a,...d.pos})),c=t.drops.flatMap(d=>({char:j(d.type)+H(d.trinket),color:Rt,size:a/2,...d.pos})),p=Math.round(Math.max(t.playerState.health,0)/100*8),r={char:"["+"â– ".repeat(p)+" ".repeat(8-p)+"]",color:"#00000080",size:a/5,x:t.playerState.pos.x,y:t.playerState.pos.y+a*.75},m=Math.round(Math.max(t.playerState.weaponHealth,0)/100*8),f={char:"["+"â– ".repeat(m)+" ".repeat(8-m)+"]",color:t.playerState.weapon!="none"?"#30300080":"transparent",size:a/5,x:t.playerState.pos.x,y:t.playerState.pos.y+a},x=t.playerState.trinkets.map((d,$)=>({char:H(d),color:"black",size:a*.75,x:k+a/2,y:($+.5)*a})),S={char:H(t.playerState.pendingTrinket),color:t.playerState.weapon!="none"?"black":"transparent",size:a*.75+Math.sin(Date.now()/125)*a/12,x:k+a/2,y:(t.playerState.trinkets.length+.5)*a},h={char:H("bible"),color:t.playerState.trinkets.includes("bible")?"black":"transparent",size:a*.75,...ht(t.playerState.pos,t.bible)},P={char:H("bible2"),color:t.playerState.trinkets.includes("bible2")?"black":"transparent",size:a*.75,...yt(t.playerState.pos,t.bible)},w={char:j(t.playerState.weapon),size:a,color:t.playerState.trinkets.includes("ghost")?At:"transparent",...dt(t.playerState.pos)},E=t.caltrops.map(d=>({...d.pos,char:"â–´",color:N,size:a*.5})),L=t.tombstones.map(d=>({char:H("tombstone"),color:"black",size:a*.75,...d.pos})),C={char:"You won!",color:t.won?"black":"transparent",size:a*2,x:k/2,y:M/2};return[...c,...l,...E,...i,o,r,f,...s,...x,...L,S,h,P,w,C]},Gt=(t,o)=>{for(let s=0;s<10;s++){const i=n.fromAngle(Math.random()*Math.PI*2),l=n.sum(n.mult(i,a),t);if(o.every(p=>!n.squareCollision(p,l,a)))return i}},Ut=t=>({pos:t,type:"slime",state:"paused",movementDirection:n.zero,symbol:Symbol(),hurt:!1,hurtSymbol:Symbol(),health:5}),Xt=t=>({pos:t,type:"fast-slime",state:"paused",movementDirection:n.zero,symbol:Symbol(),hurt:!1,hurtSymbol:Symbol(),health:5}),_t=t=>({pos:t,type:"turret",state:"paused",movementDirection:n.zero,symbol:Symbol(),hurt:!1,hurtSymbol:Symbol(),health:8}),$t=t=>({pos:t,type:"imp",state:"paused",movementDirection:n.zero,symbol:Symbol(),hurt:!1,hurtSymbol:Symbol(),health:7}),Kt=t=>({pos:t,type:"rhino",state:"paused",movementDirection:n.zero,symbol:Symbol(),hurt:!1,hurtSymbol:Symbol(),health:4}),Qt=[{type:"slime",difficulty:1,constructor:Ut},{type:"fast-slime",difficulty:2,constructor:Xt},{type:"turret",difficulty:3,constructor:_t},{type:"imp",difficulty:3,constructor:$t},{type:"rhino",difficulty:3,constructor:Kt}],jt=(t,o,s,i)=>{const l=Qt.filter(r=>s.includes(r.type));let c=Jt([t,...o]),p=i;const g=[];for(;p>0;){const r=U(l);p-=r.difficulty,g.push(r)}return g.map(r=>{const m=U(c);return c=c.filter(u=>u!=m),r.constructor(m)})},Jt=t=>{const o=M/a,s=k/a,i=[...Array(s).keys()],l=[...Array(o).keys()];return i.flatMap(p=>l.map(g=>({x:p,y:g}))).map(p=>n.mult(p,a)).filter(p=>t.every(g=>!n.squareCollision(p,g,a)))},Zt=(t,o,s,i)=>{const l=t.hurt&&s.has(t.hurtSymbol)?!1:t.hurt;return t.type=="turret"&&t.state!="paused"&&s.has(t.symbol)?(i.push({id:t.symbol,time:Math.random()*5+1}),{...t,hurt:l,state:t.state=="idle"?"shooting":"idle"}):t.type=="rhino"&&t.state!="paused"&&s.has(t.symbol)?(i.push({id:t.symbol,time:t.state=="idle"?1:Math.random()*5+1}),{...t,hurt:l,state:t.state=="moving"?"idle":"moving",movementDirection:n.normalize(n.sub(o.playerState.pos,t.pos))}):t.type=="imp"&&t.state!="paused"&&s.has(t.symbol)?(i.push({id:t.symbol,time:t.state=="idle"?Math.random()+1:1}),{...t,hurt:l,state:t.state=="moving"?"idle":"moving",movementDirection:Gt(t.pos,o.obstacles.map(c=>c.pos))}):{...t,hurt:l}},te=(t,o,s)=>{if(s.has("generic-rapid")&&t.type=="turret"&&t.state=="shooting"){const i=n.normalize(n.sub(o.playerState.pos,t.pos));return z(t.pos,n.zero,i,D,"normal",!0)}if(t.type=="imp"&&t.state=="idle"&&s.has(t.symbol)){const i=n.normalize(n.sub(o.playerState.pos,t.pos));return z(t.pos,n.zero,i,D,"normal",!0)}},ut=(t,o,s)=>{const i=g=>s.every(r=>!n.squareCollision(r,g,a)),l=n.sum(t,o);if(i(l))return l;const c={x:t.x+o.x,y:t.y};if(i(c))return c;const p={x:t.x,y:t.y+o.y};return i(p)?p:t},ee=t=>{const o=t.reduce((l,c)=>l+c.chance,0),s=Math.random()*o;let i=0;for(const l of t)if(i+=l.chance,s<=i)return l.option;return null};function I(t,o,s){const i=[],l=(u,f,x)=>Math.abs((u.x*(f.y-x.y)+f.x*(x.y-u.y)+x.x*(u.y-f.y))/2),c=u=>{const f=l(t,o,s),x=l(u,o,s),S=l(t,u,s),h=l(t,o,u);return f===x+S+h},p=Math.min(t.x,o.x,s.x),g=Math.max(t.x,o.x,s.x),r=Math.min(t.y,o.y,s.y),m=Math.max(t.y,o.y,s.y);for(let u=Math.ceil(p);u<=Math.floor(g);u++)for(let f=Math.ceil(r);f<=Math.floor(m);f++){const x={x:u,y:f};c(x)&&i.push(x)}return i}const J=(t,o)=>t.map(s=>({x:o.x-s.x,y:s.y})),gt=(t,o)=>t.map(s=>({x:s.x,y:o.y-s.y})),oe=(t,o)=>gt(J(t,o),o),q=(t,o,s,i)=>{const l=I(t,o,s).map(p=>n.mult(p,a)),c=I(o,s,i).map(p=>n.mult(p,a));return[...l,...c]},Y=t=>Array.from({length:t},(o,s)=>s),xt=t=>{const o=Y(M/a).map(c=>({x:a/2,y:c*a+a/2})),s=Y(M/a).map(c=>({x:k-a/2,y:c*a+a/2})),i=Y(k/a).map(c=>({y:a/2,x:c*a+a/2})),l=Y(k/a).map(c=>({y:M-a/2,x:c*a+a/2}));return[...o,...s,...i,...l].map(c=>({pos:c,type:t}))},se=()=>{const t=I({x:3,y:3},{x:5,y:5},{x:3,y:5}).map(l=>n.mult(l,a)),o=I({x:23,y:3},{x:21,y:5},{x:23,y:5}).map(l=>n.mult(l,a)),s=I({x:3,y:12},{x:5,y:10},{x:3,y:10}).map(l=>n.mult(l,a)),i=I({x:23,y:12},{x:21,y:10},{x:23,y:10}).map(l=>n.mult(l,a));return[...t,...o,...s,...i]},re=()=>q({x:10,y:6},{x:10,y:9},{x:17,y:6},{x:17,y:9}),ne=()=>{const t=q({x:5,y:6},{x:5,y:9},{x:12,y:6},{x:12,y:9}),o=q({x:15,y:6},{x:15,y:9},{x:22,y:6},{x:22,y:9});return[...t,...o]},G=()=>{const t=q({x:3,y:3},{x:3,y:6},{x:8,y:3},{x:8,y:6}),o=q({x:12,y:7},{x:12,y:8},{x:17,y:5},{x:17,y:10}),s=q({x:22,y:10},{x:22,y:12},{x:23,y:10},{x:23,y:12});return[...t,...o,...s]},mt=()=>{const t=q({x:10,y:4},{x:10,y:5},{x:17,y:4},{x:17,y:5}),o=q({x:10,y:6},{x:10,y:10},{x:12,y:6},{x:12,y:10}),s=q({x:10,y:10},{x:10,y:11},{x:17,y:10},{x:17,y:11});return[...t,...o,...s]},ae=t=>ee([{chance:1,option:se()},{chance:1,option:re()},{chance:1,option:ne()},{chance:1,option:G()},{chance:1,option:mt()},{chance:1,option:oe(G(),{x:k,y:M})},{chance:1,option:J(G(),{x:k,y:M})},{chance:1,option:gt(G(),{x:k,y:M})},{chance:1,option:J(mt(),{x:k,y:M})}]).map(o=>({pos:o,type:"block"})).concat(xt(t)),bt=[{name:"Level 1",walls:"wall1",enemyTypes:["slime","imp"],difficulties:[5,6,7,8,9]}],le=(t,o,s)=>{const i=bt[o],l=i?ae(i.walls):[];return{playerState:{...s,pos:X},canShoot:!0,bullets:[],enemies:i?jt(X,l.map(p=>p.pos),i.enemyTypes,i.difficulties[t]):[],obstacles:l,drops:[],roomIndex:t,levelIndex:o,bible:0,caltrops:[],tombstones:[],won:!i}},ie=t=>{const o=bt[0],s=xt(o.walls);return{playerState:{...t,pos:X},canShoot:!0,bullets:[],enemies:[],obstacles:s,drops:[...Array(3).keys()].map((l,c)=>ft({x:k/2+(c-1)*a*3,y:M/2})),roomIndex:-1,levelIndex:0,bible:0,caltrops:[],tombstones:[],won:!1}},ce=(t,o,s)=>{var nt;const{canShoot:i,obstacles:l,roomIndex:c,levelIndex:p,bible:g}=t,r={...t.playerState};let m=[...t.enemies],u=[...t.bullets],f=[...t.drops],x=[...t.caltrops],S=[...t.tombstones];const h=[],P=r.pos,w={x:(o.has("move-right")?+v:0)+(o.has("move-left")?-v:0),y:(o.has("move-down")?+v:0)+(o.has("move-up")?-v:0)},E=n.mult(w,s),L=[...m.map(e=>e.pos),...l.filter(e=>r.trinkets.includes("passthrough")?e.type!="block":!0).map(e=>e.pos)];r.pos=ut(r.pos,E,L),r.trinkets.includes("bus")&&(n.distance(P,r.pos)>.1?r.health=Math.min(r.health+Bt*s,100):r.health-=Ot*s);const C=S.filter(e=>!n.squareCollision(e.pos,r.pos,a));if(r.health=Math.min(r.health+(S.length-C.length)*5,100),S=C.map(e=>({...e,lifetime:e.lifetime+s})).filter(e=>e.lifetime<Ft),x=x.map(e=>({...e,age:e.age+=s})).filter(e=>e.age<8),o.has("swamp")){const y=[r.pos,n.sum(r.pos,n.random(a/2)),n.sum(r.pos,n.random(a/2)),n.sum(r.pos,n.random(a/2)),n.sum(r.pos,n.random(a/2))].map(b=>({age:0,pos:b}));x=x.concat(y),h.push({id:"swamp",time:1})}const $=o.has("shoot-cooldown")||i;let A=[],tt=!1;if(i){let e;if(o.has("shoot-right")?e=n.right:o.has("shoot-left")?e=n.left:o.has("shoot-up")?e=n.up:o.has("shoot-down")&&(e=n.down),e){const y=r.trinkets.includes("twins")?2:1;for(let b=0;b<y;b++)r.weapon=="none"?A.push(z(r.pos,w,e,D,"normal",!1)):r.weapon=="big-gun"?A.push(z(r.pos,w,e,D,"big",!1)):r.weapon=="uzi"?A.push(z(r.pos,w,V(e,.15),D*1.5,"small",!1)):r.weapon=="glock"?A.push(z(r.pos,w,V(e,.05),D*2,"small",!1),z(n.sum(r.pos,n.mult(e,a/2)),w,V(e,.05),D*2,"small",!1),z(n.sum(r.pos,n.mult(e,a)),w,V(e,.05),D*2,"small",!1)):r.weapon=="shotgun"&&A.push(F(r.pos,w,e),F(r.pos,w,e),F(r.pos,w,e),F(r.pos,w,e),F(r.pos,w,e)),e=n.mult(e,-1);h.push({id:"shoot-cooldown",time:Vt(r.weapon)}),tt=!0}}if(o.has("rocket")){const e=m.map(y=>({enemy:y,distance:n.distance(y.pos,r.pos)})).sort((y,b)=>y.distance-b.distance)[0];e&&A.push(z(r.pos,n.zero,n.normalize(n.sub(e.enemy.pos,r.pos)),D,"rocket",!1)),h.push({id:"rocket",time:ct})}const wt=A.filter(e=>l.every(y=>!n.squareCollision(e.pos,y.pos,a)));u=u.map(e=>({...e,pos:n.sum(e.pos,n.mult(e.speed,s))})),u=u.map(e=>({...e,speed:e.type=="shotgun"?n.mult(e.speed,1-Math.min(s*4,1)):e.type=="rocket"?n.sum(e.speed,n.mult(n.normalize(e.speed),s*500)):e.speed})).filter(e=>!(e.type=="shotgun"&&n.distance(n.zero,e.speed)<a*3)),m=m.map(e=>{if(e.state=="paused"||(e.type=="imp"||e.type=="rhino")&&e.state!="moving")return e;const y=n.sub(r.pos,e.pos),b=(()=>{switch(e.type){case"slime":case"fast-slime":return n.normalize(y);case"rhino":case"imp":return e.movementDirection;default:return n.zero}})(),B=(()=>{switch(e.type){case"slime":return n.mult(b,v/2*s);case"fast-slime":return n.mult(b,v*s);case"imp":return n.mult(b,v*s);case"rhino":return n.mult(b,v*3*s);default:return n.zero}})(),K=[r.pos,...m.filter(R=>R!=e).map(R=>R.pos),...l.map(R=>R.pos)],O=x.find(R=>n.squareCollision(R.pos,e.pos,a))?.5:1,Q=ut(e.pos,n.mult(B,O),K);return{...e,pos:Q}}),m=m.map(e=>Zt(e,t,o,h));const St=m.map(e=>te(e,t,o)).filter(e=>e);u=[...u,...wt,...St];const et=u.filter(e=>!e.enemy).flatMap(e=>m.map(y=>({bullet:e,enemy:y}))).filter(e=>n.distance(e.bullet.pos,e.enemy.pos)<=a/2),ot=new Set(et.map(e=>e.bullet));u=u.filter(e=>!ot.has(e)),m=m.map(e=>{const y=et.filter(O=>O.enemy==e).reduce((O,Q)=>O+pt(Q.bullet.type),0),b=r.trinkets.includes("bible")&&n.squareCollision(ht(r.pos,g),e.pos,a*2)?16*s:0,B=r.trinkets.includes("bible2")&&n.squareCollision(yt(r.pos,g),e.pos,a*2)?16*s:0,K=r.trinkets.includes("ghost")&&n.squareCollision(dt(r.pos),e.pos,a)?16*s:0,T=y+b+B+K;return T>0&&!e.hurt&&h.push({id:e.hurtSymbol,time:.125}),{...e,hurt:T>0?!0:e.hurt,health:e.health-T}});const kt=[...ot].filter(e=>e.type!="rocket").reduce((e,y)=>e+pt(y.type),0);r.weapon!="none"&&(r.weaponHealth-=kt*4,r.weaponHealth<0&&(r.weapon="none",r.trinkets.includes(r.pendingTrinket)||(r.trinkets=[...r.trinkets,r.pendingTrinket],r.pendingTrinket=="swamp"&&h.push({id:"swamp",time:1}),r.pendingTrinket=="rocket"&&h.push({id:"rocket",time:ct}))));const st=m.filter(e=>e.health<=0).filter(()=>Math.random()>.5),Mt=st.map(e=>ft(e.pos));if(f.push(...Mt),r.trinkets.includes("tombstone")){const e=m.filter(y=>y.health<=0).filter(y=>!st.includes(y)).map(y=>({pos:y.pos,lifetime:0}));S.push(...e)}m=m.filter(e=>e.health>0);const Dt=u.flatMap(e=>l.map(y=>({bu:e,os:y}))).filter(e=>n.squareCollision(e.bu.pos,e.os.pos,a)),zt=r.trinkets.includes("rubber");u=u.map(e=>{const y=Dt.find(b=>b.bu==e);if(!e.enemy&&e.lifetime>Lt)return null;if(!y)return{...e,lifetime:e.lifetime+s};if(!e.enemy&&zt&&e.type!="rocket"){const b=Math.abs(e.pos.x-y.os.pos.x),B=Math.abs(e.pos.y-y.os.pos.y);return{...e,lifetime:e.lifetime+s,speed:B>b?{x:e.speed.x,y:-e.speed.y}:{x:-e.speed.x,y:e.speed.y}}}return null}).filter(e=>e);const rt=u.filter(e=>e.enemy).filter(e=>n.squareCollision(e.pos,r.pos,a)),Ct=new Set(rt);u=u.filter(e=>!Ct.has(e));const qt=m.filter(e=>n.squareCollision(e.pos,r.pos,a+1));(rt.length>0||qt.length>0)&&!r.hurt&&(r.health-=Et,h.push({id:"hurt-cooldown",time:Ht}),r.hurt=!0),r.health<1&&location.reload();const W=f.find(e=>n.squareCollision(e.pos,r.pos,a));if(W&&(r.weapon=W.type,r.weaponHealth=100,r.pendingTrinket=W.trinket,r.health=Math.min(r.health+It,100),f=f.filter(e=>e!=W)),o.has("generic-rapid")&&h.push({id:"generic-rapid",time:1}),o.has("room-start-cooldown")&&(m=m.map(e=>({...e,state:"idle"})),m.filter(e=>e.type=="imp"||e.type=="turret"||e.type=="rhino").forEach(e=>h.push({id:e.symbol,time:Math.random()*4}))),o.has("hurt-cooldown")&&(r.hurt=!1),m.length==0&&l.push({pos:n.mult({x:13.5,y:14.5},a),type:"door"}),n.squareCollision(r.pos,((nt=l.find(e=>e.type=="door"))==null?void 0:nt.pos)??n.zero,a*2)){const e=le((c+1)%it,c+1==it?p+1:p,r);return h.push({id:"room-start-cooldown",time:1}),{timers:h,state:e}}return{timers:h,state:{...t,playerState:r,bullets:u,enemies:m,drops:f,canShoot:$&&!tt,bible:(g+s*2)%(Math.PI*2),caltrops:x,tombstones:S}}},Z=document.getElementById("bge-canvas");Z.width=k+a;Z.height=M;const pe=ie({health:100,pos:X,hurt:!1,weapon:"none",weaponHealth:100,trinkets:[],pendingTrinket:"bible"}),ue=[{id:"generic-rapid",time:0},{id:"room-start-cooldown",time:1}];vt(Z,pe,ce,Yt,ue);
</script>
  <style rel="stylesheet" crossorigin>*{box-sizing:border-box;overflow:hidden}html,body{width:100%;height:100%;padding:0;margin:0}#bge-canvas{width:auto;height:100%;padding:0;margin:0}
</style>
</head>

<body>
    <canvas id="bge-canvas"></canvas>
</body>

</html>